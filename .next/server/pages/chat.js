"use strict";(()=>{var e={};e.id=180,e.ids=[180,660],e.modules={323:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},814:(e,t,r)=>{r.r(t),r.d(t,{config:()=>P,default:()=>g,getServerSideProps:()=>h,getStaticPaths:()=>y,getStaticProps:()=>b,reportWebVitals:()=>_,routeModule:()=>E,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>S,unstable_getStaticProps:()=>O});var o={};r.r(o),r.d(o,{default:()=>f});var n=r(93),a=r(244),s=r(323),i=r(899),l=r.n(i),u=r(958),c=r.n(u),d=r(544),p=r(77);!function(){var e=Error("Cannot find module '../../lib/catalog'");throw e.code="MODULE_NOT_FOUND",e}();let m=r(118);async function f(e,t){if("POST"!==e.method)return t.status(405).end();let{message:r}=e.body;if(!r)return t.status(400).json({error:"missing message"});let o=(0,p.checkSafety)(r);if(!o.safe)return t.status(200).json({type:"refusal",reason:o.reason,text:"Sorry, I can't assist with that request."});let n=(0,d.parseUserMessage)(r);if("compare"===n.type&&n.compare){let[e,r]=n.compare,o=[...Object(function(){var e=Error("Cannot find module '../../lib/catalog'");throw e.code="MODULE_NOT_FOUND",e}())(e),...Object(function(){var e=Error("Cannot find module '../../lib/catalog'");throw e.code="MODULE_NOT_FOUND",e}())(r)];if(o.length<2)return t.json({type:"error",text:`I couldn't find both models to compare. I found: ${o.map(e=>e.model).join(", ")}`});let a=Array.from(new Set(o.map(e=>e.id))).map(e=>o.find(t=>t.id===e)).slice(0,2).map(e=>({id:e.id,brand:e.brand,model:e.model,price:e.price,camera:e.camera,battery:e.battery,ram:e.ram,storage:e.storage,notes:e.notes}));return t.json({type:"comparison",items:a,text:`Comparing ${a[0].brand} ${a[0].model} and ${a[1].brand} ${a[1].model}`})}if("detail"===n.type&&n.keyword){let e=Object(function(){var e=Error("Cannot find module '../../lib/catalog'");throw e.code="MODULE_NOT_FOUND",e}())(n.keyword);if(!e.length)return t.json({type:"not_found",text:`Couldn't find details for "${n.keyword}".`});let r=e[0];return t.json({type:"detail",item:r})}let a=Object(function(){var e=Error("Cannot find module '../../lib/catalog'");throw e.code="MODULE_NOT_FOUND",e}())({keyword:n.keyword||null,brand:n.brand||null,maxPrice:n.budget||null,limit:Number(process.env.MAX_RESULTS||6)}),s=`I found ${a.length} phones matching your query. Showing top ${a.length}.`;if(process.env.OPENAI_API_KEY&&a.length)try{let e=new m({apiKey:process.env.OPENAI_API_KEY}),o=`Products: ${JSON.stringify(a.slice(0,3))}

User query: ${r}`,n=await e.chat.completions.create({model:process.env.OPENAI_MODEL||"gpt-4o-mini",messages:[{role:"system",content:"You are an assistant that writes concise, factual product recommendation text. Do NOT invent specs. Use only the 'products' JSON provided in the user message."},{role:"user",content:o}],max_tokens:300}),i=n.choices?.[0]?.message?.content?.trim();return t.json({type:"search",items:a,text:i||s})}catch(e){console.error("LLM error",e.message||e)}return t.json({type:"search",items:a,text:s})}let g=(0,s.l)(o,"default"),b=(0,s.l)(o,"getStaticProps"),y=(0,s.l)(o,"getStaticPaths"),h=(0,s.l)(o,"getServerSideProps"),P=(0,s.l)(o,"config"),_=(0,s.l)(o,"reportWebVitals"),O=(0,s.l)(o,"unstable_getStaticProps"),S=(0,s.l)(o,"unstable_getStaticPaths"),v=(0,s.l)(o,"unstable_getStaticParams"),w=(0,s.l)(o,"unstable_getServerProps"),x=(0,s.l)(o,"unstable_getServerSideProps"),E=new n.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/chat",pathname:"/chat",bundlePath:"",filename:""},components:{App:c(),Document:l()},userland:o})},544:e=>{e.exports={parseUserMessage:function(e){let t=e.toLowerCase(),r={raw:e,type:"search",budget:null,brand:null,compare:null,keyword:null},o=t.match(/compare\s+(.+?)\s+vs\s+(.+)/i);if(o)return r.type="compare",r.compare=[o[1].trim(),o[2].trim()],r;let n=t.match(/(under|below)\s*₹?\s*([0-9,]+)k?/i)||t.match(/(under|below)\s*₹?\s*([0-9,]+)/i);if(n){let e=n[2].replace(/,/g,"");e.endsWith("k")&&(e=e.slice(0,-1)+"000");let t=Number(e);Number.isNaN(t)||(r.budget=t)}let a=t.match(/(\d{1,3})k\b/);for(let e of(!r.budget&&a&&(r.budget=1e3*Number(a[1])),["samsung","google","oneplus","xiaomi","poco","realme","vivo","oppo"]))t.includes(e)&&(r.brand=e);for(let e of["camera","battery","compact","one-hand","charging","fast charging","display","performance","processor","ram","storage","ois","eis"])t.includes(e)&&(r.keyword=e);let s=t.match(/(i like this phone|tell me more about|tell me more|more details about)\s*(.*)/i);return s&&(r.type="detail",r.keyword=s[2]||r.keyword),r}}},77:e=>{let t=[/api[_-]?key/i,/secret/i,/system prompt/i,/ignore your rules/i,/tell me your api key/i,/reveal your prompt/i,/trash brand (.+)/i];e.exports={checkSafety:function(e){return t.find(t=>t.test(e))?{safe:!1,reason:"forbidden_request"}:/(kill|hate|bomb)/i.test(e)?{safe:!1,reason:"toxic_request"}:{safe:!0}}}},958:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let o=r(167),n=r(997),a=o._(r(689)),s=r(201);async function i(e){let{Component:t,ctx:r}=e;return{pageProps:await (0,s.loadGetInitialProps)(t,r)}}class l extends a.default.Component{render(){let{Component:e,pageProps:t}=this.props;return(0,n.jsx)(e,{...t})}}l.origGetInitialProps=i,l.getInitialProps=i,("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},244:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},118:e=>{e.exports=require("openai")},689:e=>{e.exports=require("react")},997:e=>{e.exports=require("react/jsx-runtime")},315:e=>{e.exports=require("path")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[899],()=>r(814));module.exports=o})();