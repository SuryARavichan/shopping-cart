// pages/api/chat.js
// Serverless endpoint that handles incoming messages from the chat UI.
// Responsibilities:
// 1) Run safety checks
// 2) Parse intent
// 3) Query mock catalog
// 4) Prepare a structured response
// 5) Optionally call LLM to produce a readable explanation (with strict tooling to avoid hallucination)


import { parseUserMessage } from '../../lib/parser';
import { checkSafety } from '../../lib/safety';
import { searchByFeatures, getByModelBrand, getByIds } from '../../lib/catalog';


// Use CommonJS require when running on Node; Next supports both but ensure transpile
const OpenAI = require('openai